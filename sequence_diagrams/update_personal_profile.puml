@startuml

title Sequence diagram for Update personal profile

actor User
boundary UpdateProfileForm
control UserController
participant UserService
participant Database as "UserDB"

User -> UpdateProfileForm: (1) Enter updated profile details
activate UpdateProfileForm
UpdateProfileForm -> UserController: (2) Submit update request
activate UserController
UserController -> UserController: (3) Decode and verify JWT token

alt Invalid or missing token
    UserController --> UpdateProfileForm: (4) Return error "Unauthorized"
    deactivate UserController
    UpdateProfileForm --> User: (5) Display error message
    deactivate UpdateProfileForm
else Valid token
    UserController -> UserService: (4) Process update profile request
    activate UserService
    UserService -> UserService: (5) Validate user data
    
    alt Invalid user data
        UserService --> UserController: (6) Return error "Invalid input"
        deactivate UserService
        UserController --> UpdateProfileForm: (7) Show error message
        deactivate UserController
        UpdateProfileForm --> User: (8) Display error message
        deactivate UpdateProfileForm
    else Valid user data
        UserService -> Database: (6) Find user by ID
        activate Database
        Database --> UserService: (7) Return user (if exists)
        deactivate Database
        
        alt User not found
            UserService --> UserController: (8) Return error "User not found"
            deactivate UserService
            UserController --> UpdateProfileForm: (9) Show error message
            deactivate UserController
            UpdateProfileForm --> User: (10) Display error message
            deactivate UpdateProfileForm
        else User exists
            UserService -> UserService: (8) Update user profile data
            UserService -> Database: (9) Save updated profile
            activate Database
            Database --> UserService: (10) OK
            deactivate Database
            UserService --> UserController: (11) Return success "Profile updated successfully"
            deactivate UserService
            UserController --> UpdateProfileForm: (12) Notify user of success
            deactivate UserController
            UpdateProfileForm --> User: (13) Display success message
            deactivate UpdateProfileForm
        end
    end
end

@enduml
